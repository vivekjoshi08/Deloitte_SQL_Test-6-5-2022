use new_schema1;
CREATE TABLE department
(DNO VARCHAR (10) PRIMARY KEY,
DNAME VARCHAR (20),
MGRSTARTDATE DATE);

CREATE TABLE employee
(SSN VARCHAR (10) PRIMARY KEY,
SUPERSSN VARCHAR (10),
DNO VARCHAR (10),
FNAME VARCHAR (8),
LNAME VARCHAR (8),
ADDRESS VARCHAR (10),
SEX CHAR (1),
SALARY bigint,
FOREIGN KEY (SUPERSSN) REFERENCES employee(SSN),
FOREIGN KEY (DNO) REFERENCES department(DNO));

ALTER TABLE department
ADD MGRSSN VARCHAR (10) REFERENCES employee(SSN);

CREATE TABLE dlocation
(DNO VARCHAR (10),
DLOC VARCHAR (10),
PRIMARY KEY (DNO, DLOC),
FOREIGN KEY (DNO) REFERENCES department(DNO));

CREATE TABLE project
(PNO INTEGER PRIMARY KEY,
DNO VARCHAR (10),
PNAME VARCHAR (20),
PLOCATION VARCHAR (20),
FOREIGN KEY (DNO) REFERENCES department(DNO));

CREATE TABLE works_on
(HOURS int,
SSN VARCHAR (10),
PNO INTEGER,
PRIMARY KEY (SSN, PNO),
FOREIGN KEY (SSN) REFERENCES employee(SSN),
FOREIGN KEY (PNO) REFERENCES project(PNO)
);

INSERT INTO employee (SSN, FNAME, LNAME, ADDRESS, SEX, SALARY) VALUES
('RNSECE01','JOHN','SCOTT','BANGALORE','M', 450000),
 ('RNSCSE01','JAMES','SMITH','BANGALORE','M', 500000),
 ('RNSCSE02','HEARN','BAKER','BANGALORE','M', 700000),
 ('RNSCSE03','EDWARD','SCOTT','MYSORE','M', 500000),
 ('RNSCSE04','PAVAN','HEGDE','MANGALORE','M', 650000),
('RNSCSE05','GIRISH','MALYA','MYSORE','M', 450000),
('RNSCSE06','NEHA','SN','BANGALORE','F', 800000),
 ('RNSACC01','AHANA','K','MANGALORE','F', 350000),
('RNSACC02','SANTHOSH','KUMAR','MANGALORE','M', 300000),
('RNSISE01','VEENA','M','MYSORE','M', 600000),
('RNSIT01','NAGESH','HR','BANGALORE','M', 500000);


INSERT INTO department 
VALUES 
 ('1','ACCOUNTS','01-01-01','RNSACC02'),
 ('2','IT','01-08-16','RNSIT01'),
 ('3','ECE','01-06-08','RNSECE01'),
('4','ISE','01-08-15','RNSISE01'),
 ('5','CSE','01-06-05','RNSCSE05');
 
 UPDATE employee SET
SUPERSSN=NULL, DNO='3'
WHERE SSN='RNSECE01';

UPDATE employee SET
SUPERSSN='RNSCSE02', DNO='5'
WHERE SSN='RNSCSE01';

UPDATE employee SET
SUPERSSN='RNSCSE03', DNO='5'
WHERE SSN='RNSCSE02';

UPDATE employee SET
SUPERSSN='RNSCSE04', DNO='5'
WHERE SSN='RNSCSE03';

UPDATE employee SET
DNO='5', SUPERSSN='RNSCSE05'
WHERE SSN='RNSCSE04';

UPDATE employee SET
DNO='5', SUPERSSN='RNSCSE05'
WHERE SSN='RNSCSE04';

UPDATE employee SET
DNO='5', SUPERSSN='RNSCSE06'
WHERE SSN='RNSCSE05';

UPDATE employee SET
DNO='5', SUPERSSN=NULL
WHERE SSN='RNSCSE06';

UPDATE employee SET
DNO='1', SUPERSSN='RNSACC02'
WHERE SSN='RNSACC01';

UPDATE employee SET
DNO='1', SUPERSSN=NULL
WHERE SSN='RNSACC02';

UPDATE employee SET
DNO='4', SUPERSSN=NULL
WHERE SSN='RNSISE01';

UPDATE employee SET
DNO='2', SUPERSSN=NULL
WHERE SSN='RNSIT01';

INSERT INTO dlocation
 VALUES
 ('1', 'BANGALORE'),
('2', 'BANGALORE'),
('3', 'BANGALORE'),
('4', 'MANGALORE'),
 ('5', 'MANGALORE');

INSERT INTO project
 VALUES
 (100,'5', 'IOT','BANGALORE'),
 (101,'5','CLOUD','BANGALORE'),
(102,'5', 'BIGDATA','BANGALORE'),
 (103,'3','SENSORS','BANGALORE'),
 (104,'1','BANK MANAGEMENT','BANGALORE'),
(105,'1','SALARY MANAGEMENT','BANGALORE'),
(106,'4','OPENSTACK','BNGALORE'),
(107,'2','SMART CITY','BANGALORE');

INSERT INTO works_on
 VALUES
 (4, 'RNSCSE01', 100),
 (6, 'RNSCSE01', 101),
 (8, 'RNSCSE01', 102),
 (10, 'RNSCSE02', 100),
 (3, 'RNSCSE04', 100),
(4, 'RNSCSE05', 101),
 (5, 'RNSCSE06', 102),
(6, 'RNSCSE03', 102),
 (7, 'RNSECE01', 103),
 (5, 'RNSACC01', 104),
(6, 'RNSACC02', 105),
(4, 'RNSISE01', 106),
(10, 'RNSIT01', 107);


/* 1 */
SELECT DISTINCT P.PNO FROM PROJECT P, DEPARTMENT D, EMPLOYEE E
WHERE P.DNO=D.DNO AND D.MGRSSN=E.SSN AND E.LNAME='SCOTT'
UNION
SELECT DISTINCT W.PNO FROM WORKS_ON W, EMPLOYEE E1
WHERE E1.SSN=W.SSN AND E1.LNAME='SCOTT';

/* 2 */
SELECT E.FNAME, E.LNAME, 1.1*E.SALARY AS INCR_SAL FROM EMPLOYEE E, WORKS_ON W, PROJECT P
WHERE E.SSN=W.SSN AND W.PNO=P.PNO AND
P.PNAME='IOT';

/* 3 */
SELECT SUM(E.SALARY), MAX(E.SALARY), MIN(E.SALARY), AVG(E.SALARY)
FROM EMPLOYEE E, DEPARTMENT D WHERE E.DNO=D.DNO AND
D.DNAME='ACCOUNTS';

/* 4 */
SELECT E.FNAME, E.LNAME
FROM EMPLOYEE E WHERE NOT EXISTS(
SELECT PNO FROM PROJECT WHERE DNO=5
NOT IN (SELECT PNO FROM WORKS_ON WHERE E.SSN=SSN)
);
 
 /* 5 */
 SELECT E.DNO, COUNT(E.SSN) as "Number of Employees"
FROM EMPLOYEE E WHERE E.SALARY > 600000 AND
E.DNO IN (SELECT E1.DNO FROM EMPLOYEE E1
 GROUP BY E1.DNO HAVING COUNT(E1.DNO) > 5 )
GROUP BY E.DNO;




