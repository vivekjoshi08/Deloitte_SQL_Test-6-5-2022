USE COMPANY_DATABASE;

CREATE TABLE DEPARTMENT(
DNO INT PRIMARY KEY, 
DNAME VARCHAR(50), 
MGRSTARTD DATE, 
MGRSSN VARCHAR(50));
INSERT INTO DEPARTMENT(DNO, DNAME, MGRSTARTD, MGRSSN)
VALUES 
(1, 'ACCOUNTS', STR_TO_DATE('01-JAN-01', '%y-%M-%d'), 'RNSACC02'),
(2, 'IT', STR_TO_DATE('01-AUG-16','%y-%M-%d'), 'RNSIT01'),
(3, 'ECE', STR_TO_DATE('01-JUN-08','%y-%M-%d'), 'RNSECE01'),
(4, 'ISE', STR_TO_DATE('01-AUG-15','%y-%M-%d'), 'RNSISE01'),
(5, 'CSE', STR_TO_DATE('01-JUN-02','%y-%M-%d'), 'RNSCSE05');
SELECT * FROM DEPARTMENT;

CREATE TABLE EMPLOYEE( 
SSN VARCHAR(50) PRIMARY KEY, 
fNAME VARCHAR(20),
LNAME VARCHAR(20), 
ADDRESS VARCHAR(20), 
SEX CHAR(1), 
SALARY INT, 
SUPERSSN VARCHAR(50), 
DNO INT REFERENCES DEPARTMENT(DNO));
INSERT INTO EMPLOYEE( SSN, FNAME, LNAME, ADDRESS, SEX, SALARY, SUPERSSN, DNO)
VALUES
('RNSECE01', 'JOHN', 'SCOTT', 'BANGALORE', 'M', 45000, NULL, 3 ),
('RNSCSE01', 'JAMES', 'SMITH', 'BANGALORE', 'M', 50000, 'RNSCSE02', 5),
('RNSCSE02', 'HEARN', 'BAKER', 'BANGALORE', 'M', 70000, 'RNSCSE03', 5 ),
('RNSCSE03', 'EDWARD', 'SCOTT', 'MYSORE', 'M', 50000, 'RNSCSE04', 5),
('RNSCSE04', 'PAVAN', 'HEGDE', 'MANGALORE', 'M', 65000, 'RNSCSE05', 5),
('RNSCSE05', 'GIRISH', 'MALYA', 'MYSORE', 'M', 45000, 'RNSCSE06', 5),
('RNSCSE06', 'NEHA', 'SN', 'BANGALORE', 'F', 80000, NULL, 5),
('RNSACC01', 'AHANA', 'K', 'MANGALORE', 'F', 35000, 'RNSACC02', 1),
('RNSACC02', 'SANTHOSH', 'KUAMR', 'MANGALORE', 'M', 30000, NULL,1),
('RNSISE01', 'VEENA', 'M', 'MYSORE', 'M', 60000, NULL, 4),
('RNSIT01', 'NAGESH', 'HR', 'BANGALORE', 'M', 50000, NULL, 2);
SELECT * FROM EMPLOYEE;

CREATE TABLE DLOCATION (
DNO INT REFERENCES DEPARTMENT(DNO), 
DLOC VARCHAR(50));
INSERT INTO DLOCATION (DNO, DLOC)
VALUES 
(1, 'BANGALORE'),
(2, 'BANGALORE'),
(3, 'BANGALORE'),
(4, 'MANGALORE'),
(5, 'MANGALORE');
SELECT * FROM DLOCATION;

CREATE TABLE PROJECT(
PNO INT PRIMARY KEY, 
PNAME VARCHAR(30), 
PLOCATION VARCHAR(50), 
DNO INT REFERENCES DEPARTMENT(DNO));
INSERT INTO PROJECT(PNO, PNAME, PLOCATION, DNO)
VALUES
(100, 'IOT', 'BANGALORE', 5),
(101, 'CLOUD', 'BANGALORE', 5),
(102, 'BIGDATA', 'BANGALORE', 5), 
(103, 'SENSORS', 'BANGALORE', 3), 
(104, 'BANK MANAGEMENT', 'BANGALORE', 1),
(105, 'SALARY MANAGEMENT', 'BANGALORE', 1),
(106, 'OPENSTACK', 'BANGALORE', 4),
(107, 'SMART CITY', 'BANGALORE', 2);
SELECT * FROM PROJECT;

CREATE TABLE WORKS_ON(
PNO INT REFERENCES PROJECT(PNO), 
SSN VARCHAR(50) REFERENCES EMPLOYEE(SSN), 
HOURS INT);
INSERT INTO WORKS_ON(PNO, SSN, HOURS)
VALUES
(100, 'RNSCSE01', 4),
(101, 'RNSCSE01', 6),
(102, 'RNSCSE01', 8),
(100, 'RNSCSE02', 10),
(100, 'RNSCSE04', 3),
(101, 'RNSCSE05', 4),
(102, 'RNSCSE06', 5),
(102, 'RNSCSE03', 6),
(103, 'RNSECE01', 7),
(104, 'RNSACC01', 5),
(105, 'RNSACC02', 6),
(106, 'RNSISE01', 4),
(107, 'RNSit01', 10);
SELECT * FROM WORKS_ON;


/*1*/
SELECT DISTINCT PNO FROM PROJECT
NATURAL JOIN EMPLOYEE
WHERE LNAME='SCOTT';

/*2*/
SELECT FNAME, 1.1*SALARY FROM EMPLOYEE
NATURAL JOIN WORKS_ON
NATURAL JOIN PROJECT
WHERE PNAME = 'IOT';

/*3*/
SELECT SUM(SALARY), MAX(SALARY), MIN(SALARY), AVG(SALARY),DNAME FROM EMPLOYEE
NATURAL JOIN DEPARTMENT
WHERE DNAME='ACCOUNTS';

/*4*/
SELECT FNAME, LNAME FROM EMPLOYEE
WHERE NOT EXISTS (SELECT PNO FROM PROJECT WHERE DNO=5
NOT IN (SELECT PNO FROM WORKS_ON WHERE EMPLOYEE.SSN=SSN));

/*5*/
SELECT D.DNO, COUNT(*) FROM DEPARTMENT D
INNER JOIN EMPLOYEE E ON D.DNO=E.DNO
WHERE SALARY>600000 AND D.DNO IN 
(SELECT DNO FROM EMPLOYEE GROUP BY DNO HAVING COUNT(*)>5);